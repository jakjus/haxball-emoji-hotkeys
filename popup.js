let emojiList = 'ðŸ˜€ ðŸ˜ƒ ðŸ˜„ ðŸ˜ ðŸ˜† ðŸ˜… ðŸ¤£ ðŸ˜‚ ðŸ™‚ ðŸ™ƒ ðŸ«  ðŸ˜‰ ðŸ˜Š ðŸ˜‡ ðŸ¥° ðŸ˜ ðŸ¤© ðŸ˜˜ ðŸ˜— ðŸ˜š ðŸ˜™ ðŸ¥²  ðŸ˜› ðŸ˜œ ðŸ¤ª ðŸ˜ ðŸ¤‘ ðŸ¤— ðŸ¤­ ðŸ«¢ ðŸ«£ ðŸ¤« ðŸ¤” ðŸ«¡ ðŸ¤ ðŸ¤¨ ðŸ˜ ðŸ˜‘ ðŸ˜¶ ðŸ«¥ ðŸ˜ ðŸ˜’ ðŸ™„ ðŸ˜¬ ðŸ¤¥ ðŸ˜Œ ðŸ˜” ðŸ˜ª ðŸ¤¤ ðŸ˜´ ðŸ˜· ðŸ¤’ ðŸ¤• ðŸ¤¢ ðŸ¤® ðŸ¤§ ðŸ¥µ ðŸ¥¶ ðŸ¥´ ðŸ˜µ ðŸ¤¯ ðŸ¤  ðŸ¥³ ðŸ¥¸ ðŸ˜Ž ðŸ¤“ ðŸ§ ðŸ˜• ðŸ«¤ ðŸ˜Ÿ ðŸ™ ðŸ˜® ðŸ˜¯ ðŸ˜² ðŸ˜³ ðŸ¥º ðŸ¥¹ ðŸ˜¦ ðŸ˜§ ðŸ˜¨ ðŸ˜° ðŸ˜¥ ðŸ˜¢ ðŸ˜­ ðŸ˜± ðŸ˜– ðŸ˜£ ðŸ˜ž ðŸ˜“ ðŸ˜© ðŸ˜« ðŸ¥± ðŸ˜¤ ðŸ˜¡ ðŸ˜  ðŸ¤¬ ðŸ˜ˆ ðŸ‘¿ ðŸ’€ ðŸ’© ðŸ¤¡ ðŸ‘¹ ðŸ‘º ðŸ‘» ðŸ‘½ ðŸ‘¾ ðŸ¤– ðŸ˜º ðŸ˜¸ ðŸ˜¹ ðŸ˜» ðŸ˜¼ ðŸ˜½ ðŸ™€ ðŸ˜¿ ðŸ˜¾ ðŸ™ˆ ðŸ™‰ ðŸ™Š ðŸ’‹ ðŸ’Œ ðŸ’˜ ðŸ’ ðŸ’– ðŸ’— ðŸ’“ ðŸ’ž ðŸ’• ðŸ’Ÿ ðŸ’” ðŸ§¡ ðŸ’› ðŸ’š ðŸ’™ ðŸ’œ ðŸ¤Ž ðŸ–¤ ðŸ¤ ðŸ’¯ ðŸ’¢ ðŸ’¥ ðŸ’« ðŸ’¦ ðŸ’¨ ðŸ’£ ðŸ’¬ ðŸ’­ ðŸ’¤ ðŸ‘‹ ðŸ¤š âœ‹ ðŸ–– ðŸ«± ðŸ«² ðŸ«³ ðŸ«´ ðŸ‘Œ ðŸ¤Œ ðŸ¤ ðŸ¤ž ðŸ«° ðŸ¤Ÿ ðŸ¤˜ ðŸ¤™ ðŸ‘ˆ ðŸ‘‰ ðŸ‘† ðŸ–• ðŸ‘‡ ðŸ«µ ðŸ‘ ðŸ‘Ž âœŠ ðŸ‘Š ðŸ¤› ðŸ¤œ ðŸ‘ ðŸ™Œ ðŸ«¶ ðŸ‘ ðŸ¤² ðŸ¤ ðŸ™ ðŸ’… ðŸ¤³ ðŸ’ª ðŸ¦¾ ðŸ¦¿ ðŸ¦µ ðŸ¦¶ ðŸ‘‚ ðŸ¦» ðŸ‘ƒ ðŸ§  ðŸ«€ ðŸ« ðŸ¦· ðŸ¦´ ðŸ‘€ ðŸ‘… ðŸ‘„ ðŸ«¦ ðŸ‘¶ ðŸ§’ ðŸ‘¦ ðŸ‘§ ðŸ§‘ ðŸ‘± ðŸ‘¨ ðŸ§” ðŸ‘© ðŸ§“ ðŸ‘´ ðŸ‘µ ðŸ™ ðŸ™Ž ðŸ™… ðŸ™† ðŸ’ ðŸ™‹ ðŸ§ ðŸ™‡ ðŸ¤¦ ðŸ¤· ðŸ‘® ðŸ’‚ ðŸ¥· ðŸ‘· ðŸ«… ðŸ¤´ ðŸ‘¸ ðŸ‘³ ðŸ‘² ðŸ§• ðŸ¤µ ðŸ‘° ðŸ¤° ðŸ«ƒ ðŸ«„ ðŸ¤± ðŸ‘¼ ðŸŽ… ðŸ¤¶ ðŸ¦¸ ðŸ¦¹ ðŸ§™ ðŸ§š ðŸ§› ðŸ§œ ðŸ§ ðŸ§ž ðŸ§Ÿ ðŸ§Œ ðŸ’† ðŸ’‡ ðŸš¶ ðŸ§ ðŸ§Ž ðŸƒ ðŸ’ƒ ðŸ•º ðŸ‘¯ ðŸ§– ðŸ§— ðŸ¤º ðŸ‡ ðŸ‚ ðŸ„ ðŸš£ ðŸŠ ðŸš´ ðŸšµ ðŸ¤¸ ðŸ¤¼ ðŸ¤½ ðŸ¤¾ ðŸ¤¹ ðŸ§˜ ðŸ›€ ðŸ›Œ ðŸ‘­ ðŸ‘« ðŸ‘¬ ðŸ’ ðŸ’‘ ðŸ‘ª ðŸ‘¤ ðŸ‘¥ ðŸ«‚ ðŸ‘£ ðŸ¦° ðŸ¦± ðŸ¦³ ðŸ¦² ðŸµ ðŸ’ ðŸ¦ ðŸ¦§ ðŸ¶ ðŸ• ðŸ¦® ðŸ© ðŸº ðŸ¦Š ðŸ¦ ðŸ± ðŸˆ ðŸ¦ ðŸ¯ ðŸ… ðŸ† ðŸ´ ðŸŽ ðŸ¦„ ðŸ¦“ ðŸ¦Œ ðŸ¦¬ ðŸ® ðŸ‚ ðŸƒ ðŸ„ ðŸ· ðŸ– ðŸ— ðŸ½ ðŸ ðŸ‘ ðŸ ðŸª ðŸ« ðŸ¦™ ðŸ¦’ ðŸ˜ ðŸ¦£ ðŸ¦ ðŸ¦› ðŸ­ ðŸ ðŸ€ ðŸ¹ ðŸ° ðŸ‡ ðŸ¦« ðŸ¦” ðŸ¦‡ ðŸ» ðŸ¨ ðŸ¼ ðŸ¦¥ ðŸ¦¦ ðŸ¦¨ ðŸ¦˜ ðŸ¦¡ ðŸ¾ ðŸ¦ƒ ðŸ” ðŸ“ ðŸ£ ðŸ¤ ðŸ¥ ðŸ¦ ðŸ§ ðŸ¦… ðŸ¦† ðŸ¦¢ ðŸ¦‰ ðŸ¦¤ ðŸª¶ ðŸ¦© ðŸ¦š ðŸ¦œ ðŸ¸ ðŸŠ ðŸ¢ ðŸ¦Ž ðŸ ðŸ² ðŸ‰ ðŸ¦• ðŸ¦– ðŸ³ ðŸ‹ ðŸ¬ ðŸ¦­ ðŸŸ ðŸ  ðŸ¡ ðŸ¦ˆ ðŸ™ ðŸš ðŸª¸ ðŸŒ ðŸ¦‹ ðŸ› ðŸœ ðŸ ðŸª² ðŸž ðŸ¦— ðŸª³ ðŸ¦‚ ðŸ¦Ÿ ðŸª° ðŸª± ðŸ¦  ðŸ’ ðŸŒ¸ ðŸ’® ðŸª· ðŸŒ¹ ðŸ¥€ ðŸŒº ðŸŒ» ðŸŒ¼ ðŸŒ· ðŸŒ± ðŸª´ ðŸŒ² ðŸŒ³ ðŸŒ´ ðŸŒµ ðŸŒ¾ ðŸŒ¿ ðŸ€ ðŸ ðŸ‚ ðŸƒ ðŸª¹ ðŸªº ðŸ‡ ðŸˆ ðŸ‰ ðŸŠ ðŸ‹ ðŸŒ ðŸ ðŸ¥­ ðŸŽ ðŸ ðŸ ðŸ‘ ðŸ’ ðŸ“ ðŸ« ðŸ¥ ðŸ… ðŸ«’ ðŸ¥¥ ðŸ¥‘ ðŸ† ðŸ¥” ðŸ¥• ðŸŒ½ ðŸ«‘ ðŸ¥’ ðŸ¥¬ ðŸ¥¦ ðŸ§„ ðŸ§… ðŸ„ ðŸ¥œ ðŸ«˜ ðŸŒ° ðŸž ðŸ¥ ðŸ¥– ðŸ«“ ðŸ¥¨ ðŸ¥¯ ðŸ¥ž ðŸ§‡ ðŸ§€ ðŸ– ðŸ— ðŸ¥© ðŸ¥“ ðŸ” ðŸŸ ðŸ• ðŸŒ­ ðŸ¥ª ðŸŒ® ðŸŒ¯ ðŸ«” ðŸ¥™ ðŸ§† ðŸ¥š ðŸ³ ðŸ¥˜ ðŸ² ðŸ«• ðŸ¥£ ðŸ¥— ðŸ¿ ðŸ§ˆ ðŸ§‚ ðŸ¥« ðŸ± ðŸ˜ ðŸ™ ðŸš ðŸ› ðŸœ ðŸ ðŸ  ðŸ¢ ðŸ£ ðŸ¤ ðŸ¥ ðŸ¥® ðŸ¡ ðŸ¥Ÿ ðŸ¥  ðŸ¥¡ ðŸ¦€ ðŸ¦ž ðŸ¦ ðŸ¦‘ ðŸ¦ª ðŸ¦ ðŸ§ ðŸ¨ ðŸ© ðŸª ðŸŽ‚ ðŸ° ðŸ§ ðŸ¥§ ðŸ« ðŸ¬ ðŸ­ ðŸ® ðŸ¯ ðŸ¼ ðŸ¥› â˜• ðŸ«– ðŸµ ðŸ¶ ðŸ¾ ðŸ· ðŸ¸ ðŸ¹ ðŸº ðŸ» ðŸ¥‚ ðŸ¥ƒ ðŸ«— ðŸ¥¤ ðŸ§‹ ðŸ§ƒ ðŸ§‰ ðŸ§Š ðŸ¥¢ ðŸ´ ðŸ¥„ ðŸ”ª ðŸ«™ ðŸº ðŸŒ ðŸŒŽ ðŸŒ ðŸŒ ðŸ—¾ ðŸ§­ ðŸŒ‹ ðŸ—» ðŸ§± ðŸª¨ ðŸªµ ðŸ›– ðŸ  ðŸ¡ ðŸ¢ ðŸ£ ðŸ¤ ðŸ¥ ðŸ¦ ðŸ¨ ðŸ© ðŸª ðŸ« ðŸ¬ ðŸ­ ðŸ¯ ðŸ° ðŸ’’ ðŸ—¼ ðŸ—½ â›ª ðŸ•Œ ðŸ›• ðŸ• ðŸ•‹ â›² â›º ðŸŒ ðŸŒƒ ðŸŒ„ ðŸŒ… ðŸŒ† ðŸŒ‡ ðŸŒ‰ ðŸŽ  ðŸ› ðŸŽ¡ ðŸŽ¢ ðŸ’ˆ ðŸŽª ðŸš‚ ðŸšƒ ðŸš„ ðŸš… ðŸš† ðŸš‡ ðŸšˆ ðŸš‰ ðŸšŠ ðŸš ðŸšž ðŸš‹ ðŸšŒ ðŸš ðŸšŽ ðŸš ðŸš‘ ðŸš’ ðŸš“ ðŸš” ðŸš• ðŸš– ðŸš— ðŸš˜ ðŸš™ ðŸ›» ðŸšš ðŸš› ðŸšœ ðŸ›µ ðŸ¦½ ðŸ¦¼ ðŸ›º ðŸš² ðŸ›´ ðŸ›¹ ðŸ›¼ ðŸš â›½ ðŸ›ž ðŸš¨ ðŸš¥ ðŸš¦ ðŸ›‘ ðŸš§ âš“ ðŸ›Ÿ â›µ ðŸ›¶ ðŸš¤ ðŸš¢ ðŸ›« ðŸ›¬ ðŸª‚ ðŸ’º ðŸš ðŸšŸ ðŸš  ðŸš¡ ðŸš€ ðŸ›¸ ðŸ§³ âŒ› â³ âŒš â° ðŸ•› ðŸ•§ ðŸ• ðŸ•œ ðŸ•‘ ðŸ• ðŸ•’ ðŸ•ž ðŸ•“ ðŸ•Ÿ ðŸ•” ðŸ•  ðŸ•• ðŸ•¡ ðŸ•– ðŸ•¢ ðŸ•— ðŸ•£ ðŸ•˜ ðŸ•¤ ðŸ•™ ðŸ•¥ ðŸ•š ðŸ•¦ ðŸŒ‘ ðŸŒ’ ðŸŒ“ ðŸŒ” ðŸŒ• ðŸŒ– ðŸŒ— ðŸŒ˜ ðŸŒ™ ðŸŒš ðŸŒ› ðŸŒœ ðŸŒ ðŸŒž ðŸª â­ ðŸŒŸ ðŸŒ  ðŸŒŒ â›… ðŸŒ€ ðŸŒˆ ðŸŒ‚ â˜” âš¡ â›„ ðŸ”¥ ðŸ’§ ðŸŒŠ ðŸŽƒ ðŸŽ„ ðŸŽ† ðŸŽ‡ ðŸ§¨ âœ¨ ðŸŽˆ ðŸŽ‰ ðŸŽŠ ðŸŽ‹ ðŸŽ ðŸŽŽ ðŸŽ ðŸŽ ðŸŽ‘ ðŸ§§ ðŸŽ€ ðŸŽ ðŸŽ« ðŸ† ðŸ… ðŸ¥‡ ðŸ¥ˆ ðŸ¥‰ âš½ âš¾ ðŸ¥Ž ðŸ€ ðŸ ðŸˆ ðŸ‰ ðŸŽ¾ ðŸ¥ ðŸŽ³ ðŸ ðŸ‘ ðŸ’ ðŸ¥ ðŸ“ ðŸ¸ ðŸ¥Š ðŸ¥‹ ðŸ¥… â›³ ðŸŽ£ ðŸ¤¿ ðŸŽ½ ðŸŽ¿ ðŸ›· ðŸ¥Œ ðŸŽ¯ ðŸª€ ðŸª ðŸŽ± ðŸ”® ðŸª„ ðŸ§¿ ðŸª¬ ðŸŽ® ðŸŽ° ðŸŽ² ðŸ§© ðŸ§¸ ðŸª… ðŸª© ðŸª† ðŸƒ ðŸ€„ ðŸŽ´ ðŸŽ­ ðŸŽ¨ ðŸ§µ ðŸª¡ ðŸ§¶ ðŸª¢ ðŸ‘“ ðŸ¥½ ðŸ¥¼ ðŸ¦º ðŸ‘” ðŸ‘• ðŸ‘– ðŸ§£ ðŸ§¤ ðŸ§¥ ðŸ§¦ ðŸ‘— ðŸ‘˜ ðŸ¥» ðŸ©± ðŸ©² ðŸ©³ ðŸ‘™ ðŸ‘š ðŸ‘› ðŸ‘œ ðŸ‘ ðŸŽ’ ðŸ©´ ðŸ‘ž ðŸ‘Ÿ ðŸ¥¾ ðŸ¥¿ ðŸ‘  ðŸ‘¡ ðŸ©° ðŸ‘¢ ðŸ‘‘ ðŸ‘’ ðŸŽ© ðŸŽ“ ðŸ§¢ ðŸª– ðŸ“¿ ðŸ’„ ðŸ’ ðŸ’Ž ðŸ”‡ ðŸ”ˆ ðŸ”‰ ðŸ”Š ðŸ“¢ ðŸ“£ ðŸ“¯ ðŸ”” ðŸ”• ðŸŽ¼ ðŸŽµ ðŸŽ¶ ðŸŽ¤ ðŸŽ§ ðŸ“» ðŸŽ· ðŸª— ðŸŽ¸ ðŸŽ¹ ðŸŽº ðŸŽ» ðŸª• ðŸ¥ ðŸª˜ ðŸ“± ðŸ“² ðŸ“ž ðŸ“Ÿ ðŸ“  ðŸ”‹ ðŸª« ðŸ”Œ ðŸ’» ðŸ’½ ðŸ’¾ ðŸ’¿ ðŸ“€ ðŸ§® ðŸŽ¥ ðŸŽ¬ ðŸ“º ðŸ“· ðŸ“¸ ðŸ“¹ ðŸ“¼ ðŸ” ðŸ”Ž ðŸ’¡ ðŸ”¦ ðŸ® ðŸª” ðŸ“” ðŸ“• ðŸ“– ðŸ“— ðŸ“˜ ðŸ“™ ðŸ“š ðŸ““ ðŸ“’ ðŸ“ƒ ðŸ“œ ðŸ“„ ðŸ“° ðŸ“‘ ðŸ”– ðŸ’° ðŸª™ ðŸ’´ ðŸ’µ ðŸ’¶ ðŸ’· ðŸ’¸ ðŸ’³ ðŸ§¾ ðŸ’¹ ðŸ“§ ðŸ“¨ ðŸ“© ðŸ“¤ ðŸ“¥ ðŸ“¦ ðŸ“« ðŸ“ª ðŸ“¬ ðŸ“­ ðŸ“® ðŸ“ ðŸ’¼ ðŸ“ ðŸ“‚ ðŸ“… ðŸ“† ðŸ“‡ ðŸ“ˆ ðŸ“‰ ðŸ“Š ðŸ“‹ ðŸ“Œ ðŸ“ ðŸ“Ž ðŸ“ ðŸ“ ðŸ”’ ðŸ”“ ðŸ” ðŸ” ðŸ”‘ ðŸ”¨ ðŸª“ ðŸ”« ðŸªƒ ðŸ¹ ðŸªš ðŸ”§ ðŸª› ðŸ”© ðŸ¦¯ ðŸ”— ðŸª ðŸ§° ðŸ§² ðŸªœ ðŸ§ª ðŸ§« ðŸ§¬ ðŸ”¬ ðŸ”­ ðŸ“¡ ðŸ’‰ ðŸ©¸ ðŸ’Š ðŸ©¹ ðŸ©¼ ðŸ©º ðŸ©» ðŸšª ðŸ›— ðŸªž ðŸªŸ ðŸª‘ ðŸš½ ðŸª  ðŸš¿ ðŸ› ðŸª¤ ðŸª’ ðŸ§´ ðŸ§· ðŸ§¹ ðŸ§º ðŸ§» ðŸª£ ðŸ§¼ ðŸ«§ ðŸª¥ ðŸ§½ ðŸ§¯ ðŸ›’ ðŸš¬ ðŸª¦ ðŸ—¿ ðŸª§ ðŸªª ðŸ§ ðŸš® ðŸš° â™¿ ðŸš¹ ðŸšº ðŸš» ðŸš¼ ðŸš¾ ðŸ›‚ ðŸ›ƒ ðŸ›„ ðŸ›… ðŸš¸ â›” ðŸš« ðŸš³ ðŸš­ ðŸš¯ ðŸš± ðŸš· ðŸ“µ ðŸ”ž ðŸ”ƒ ðŸ”„ ðŸ”™ ðŸ”š ðŸ”› ðŸ”œ ðŸ” ðŸ› ðŸ•Ž ðŸ”¯ â™ˆ â™‰ â™Š â™‹ â™Œ â™ â™Ž â™ â™ â™‘ â™’ â™“ â›Ž ðŸ”€ ðŸ” ðŸ”‚ â© âª ðŸ”¼ â« ðŸ”½ â¬ ðŸŽ¦ ðŸ”… ðŸ”† ðŸ“¶ ðŸ“³ ðŸ“´ âž• âž– âž— ðŸŸ° â“ â” â• â— ðŸ’± ðŸ’² ðŸ”± ðŸ“› ðŸ”° â­• âœ… âŒ âŽ âž° âž¿ ðŸ”Ÿ ðŸ”  ðŸ”¡ ðŸ”¢ ðŸ”£ ðŸ”¤ ðŸ†Ž ðŸ†‘ ðŸ†’ ðŸ†“ ðŸ†” ðŸ†• ðŸ†– ðŸ†— ðŸ†˜ ðŸ†™ ðŸ†š ðŸˆ ðŸˆ¶ ðŸˆ¯ ðŸ‰ ðŸˆ¹ ðŸˆš ðŸˆ² ðŸ‰‘ ðŸˆ¸ ðŸˆ´ ðŸˆ³ ðŸˆº ðŸˆµ ðŸ”´ ðŸŸ  ðŸŸ¡ ðŸŸ¢ ðŸ”µ ðŸŸ£ ðŸŸ¤ âš« âšª ðŸŸ¥ ðŸŸ§ ðŸŸ¨ ðŸŸ© ðŸŸ¦ ðŸŸª ðŸŸ« â¬› â¬œ â—¾ â—½ ðŸ”¶ ðŸ”· ðŸ”¸ ðŸ”¹ ðŸ”º ðŸ”» ðŸ’  ðŸ”˜ ðŸ”³ ðŸ”² ðŸ ðŸš© ðŸŽŒ ðŸ´'

let emojiArray = emojiList.split(' ')

button = document.getElementById('addNewEmoji')

function handleKeyChange(e) {
  kk = e.target
  let prevKey = kk.innerText
  kk.innerText = 'Press a key'
  document.addEventListener('keydown', logKey)
  function logKey(e) {
    kk.innerText = e.code
    document.removeEventListener('keydown', logKey)
    let em = kk.parentElement.querySelector('.emoji').innerText
    chrome.storage.sync.get("emojis", ({ emojis })  => {
      delete emojis[prevKey]
      emojis[e.code] = em
      chrome.storage.sync.set({ emojis })
    })
  }
}

function addEmoji(text, key){
  chrome.storage.sync.get("emojis", ({ emojis }) => {
    emojis[key] = text
    chrome.storage.sync.set({ emojis })
  })
}

function addDOM(text, key){
  newEmoji = document.createElement("div")
  newEmoji.innerHTML = `<div class="hotkey"><span class="emoji">${text}</span><p class="key">${key}</p><img class="remove" src="images/x.png"></img></div>`
  container = document.getElementById('activeEmojis')
  container.appendChild(newEmoji)
  let kk = newEmoji.querySelector('.key')
  let x = newEmoji.querySelector('.remove')
  let eh = newEmoji.querySelector('.emoji')
  kk.addEventListener("click", handleKeyChange)
  x.addEventListener("click", handleRemove)
  eh.addEventListener("click", handleEmojiClick)
}

emojiNodes = []
emojiArray.map(e => {
  node = document.createElement("span")
  node.className = 'singleEmoji'
  node.innerHTML = e
  emojiNodes.push(node)
});

let chooserOpen = false

function chooseAndClose(e, eh, emojichooser) {
  let peh = eh.parentElement
  let choice = e.innerText || e.value  // It can be text or emoji
  peh.querySelector('.emoji').innerText = choice
  let currentKeyElem = peh.querySelector('.key')
  if (currentKeyElem){
    let currentKey = currentKeyElem.innerText
    chrome.storage.sync.get("emojis", ({ emojis })  => {
      emojis[currentKey] = e.innerText || e.value
      chrome.storage.sync.set({ emojis })
    })
  } else {
    chrome.storage.sync.get("defaultEmoji", ({ defaultEmoji })  => {
      defaultEmoji = e.innerText || e.value
      chrome.storage.sync.set({ defaultEmoji })
    })
  }
  chooserOpen = false; 
  emojichooser.remove();
}

function handleEmojiClick(e) {
  eh = e.target
  if (!chooserOpen){
    chooserOpen = !chooserOpen
    list = document.createElement("div")
    list.innerHTML = `<div class="emojichooser"><input id="textemoji"></input><img class="remove" src="images/x.png"></img></div>`
    input = list.querySelector('#textemoji')
    input.addEventListener("input", (e) => {
      if (e.target.value.length > 1){
        chooseAndClose(e.target, eh, input.parentElement)
      }
    })
    emojiNodes.map(emoji => {
      list.querySelector('.emojichooser').appendChild(emoji)
      emoji.addEventListener("click", (emojiInList) => {
        chooseAndClose(emojiInList.target, eh, emoji.parentElement)
      }) 
    })
    eh.parentElement.parentElement.parentElement.parentElement.appendChild(list)
    let x = list.querySelector('.remove')
    x.addEventListener("click", () => {chooserOpen = false; x.parentElement.remove()})
    return
  }
  if (chooserOpen){
    chooserOpen = false; eh.parentElement.parentElement.parentElement.parentElement.querySelector('.emojichooser').remove();
    return
  }
}

function handleRemove(e) {
  x = e.target
  chrome.storage.sync.get("emojis", ({ emojis }) => {
    delete emojis[x.parentElement.querySelector('.key').innerText]
    chrome.storage.sync.set({ emojis })
  })
  x.parentElement.remove()
}

function add(text, key){
  if (!text || !key) { text = ':)'; key = 'No key' }
  addDOM(text,key)
  addEmoji(text,key)
}

button.onclick = add

function view(){
  chrome.storage.sync.get("defaultEmoji", ({ defaultEmoji }) => {
    container = document.getElementById('defaultEmoji')
    container.innerText = defaultEmoji
    container.addEventListener("click", handleEmojiClick)
  })
  chrome.storage.sync.get("emojis", ({ emojis }) => {
    Object.keys(emojis).forEach(e => addDOM(emojis[e], e))
  })
}

view()
